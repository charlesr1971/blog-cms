
<ng-template class="dialog-submit-article-notification" #dialogSubmitArticleNotification>
  <form novalidate [formGroup]="submitArticleNotificationForm">
    <div class="container" fxLayout="column" fxLayoutAlign="space-evenly stretch">
      <h1 mat-dialog-title>Submit Article Alert</h1>
      <mat-dialog-content fxFlex>
        <p>
          <strong>You are about to submit changes, not only to the article, but also to the image title, description and tags</strong><br /><br />
          <mat-checkbox formControlName="submitArticleNotification">Do you wish to see this alert again?</mat-checkbox>
        </p>
      </mat-dialog-content>
      <mat-dialog-actions class="actions">
        <button mat-raised-button mat-dialog-close data-role="cancel" color="primary">Cancel</button>
        <button mat-raised-button data-role="submit" [mat-dialog-close]="true" cdkFocusInitial color="accent">Submit</button>
      </mat-dialog-actions>
    </div>
  </form>
</ng-template>

<ng-template class="dialog-article-max-word-count-notification" #dialogArticleMaxWordCountNotification>
  <div class="container" fxLayout="column" fxLayoutAlign="space-evenly stretch">
    <h1 mat-dialog-title>Article Maximum Word Count Alert</h1>
    <mat-dialog-content fxFlex>
      <p>
        <strong>Article maximum word count of {{ tinyMceArticleMaxWordCount }} has been reached</strong>
      </p>
    </mat-dialog-content>
    <mat-dialog-actions class="actions">
      <button mat-raised-button mat-dialog-close data-role="cancel" color="primary">Close</button>
    </mat-dialog-actions>
  </div>
</ng-template>

<ng-template class="dialog-article-help-notification" #dialogArticleHelpNotification>
  <div id="dialog-article-help-notification-container" class="mat-app-background basic-container dialog-help" style="opacity:0;">
    <div class="form-field-container">
      <div class="form-field-legend">How to use this page?</div>
      <div class="form-field-text dialogText" id="dialogArticleHelpNotificationText" #dialogArticleHelpNotificationText>
        <ol>
          <li value="1">Upload a photo, making sure you fill in 'Author', 'Image Title' &amp; 'Image Description' fields. The 'Image Description' field has a maximum length of {{ articledescriptionmaxcharcount }} characters. Then choose a 'Category' &amp; an 'Image'.</li>
          <li>'Tags', 'Image Accreditation' and 'Image Orientation' are optional features.</li>
          <li>The 'Image Orientation' select control has two options. The first option is 'auto'. This will automatically calculate the width to height ratio of an image. If the image is determined to be of 'square' or 'portrait' proportions, it will be displayed without having it's aspect ratio, altered. If the image is determined to be of 'landscape' proportions or the 'landscape' option is chosen, the image will be stretched to fit the entire width of the article image panel. For the most optimum viewing experience, please upload images that are either of 'landscape' proportions or have a standalone landscape section within the central part of the image. By default, if neither option is chosen, the image will use the 'landscape' feature.</li>
          <li>New data can only be submitted from within the 'Choose Image' modal dialog panel. Once an image has been selected, press the 'Submit' button to upload data from all the form fields.<br /><img src="assets/images/help/upload-image/choose-image-dialog-help-image-{{ themeSuffix }}.png" /></li>
          <li>Images must be less than {{ maxcontentlengthInMb }}MB in memory size.</li>
          <li class="list-item-hide-ordinal important">
            <div>
              <div>Summary</div>
              <div>
                <p>
                  Data submission is a two part process.<br /><br />The first part involves the submission of the following fields:
                </p>
                <ol>
                  <li>Author <em>required</em></li>
                  <li>Image Title <em>required</em></li>
                  <li>Image Description <em>required</em></li>
                  <li>Tags <em>optional</em></li>
                  <li>Category <em>required</em></li>
                  <li>Image Accreditation <em>optional</em></li>
                  <li>Image Orientation <em>optional</em></li>
                  <li>Image <em>required</em></li>
                </ol>
                <p style="margin-top:16px;">
                  The second part involves the submission of the following fields:
                </p>
                <ol>
                  <li>Article <em>optional</em></li>
                  <li>Article Publish Date <em>optional</em></li>
                </ol> 
              </div>
            </div>
          </li>
          <li value="1">After submission of your image details, the 'Write Article' &amp; 'Article Publish Date' features will become available.</li>
          <li>Add an article by pressing on the 'Write Article' button. This will open up a modal dialog, containing a fully featured WYSIWYG text editor. Make sure that you do not exceed the {{ tinyMceArticleMaxWordCount }} word limit. A maximimum of {{ tinymcearticlemaximages }} images can be added to each article, using the text editor's upload feature. Article content can either be published from within the text editor dialog or by pressing the 'Submit' button at the bottom of this page.<br /><img src="assets/images/help/upload-image/tinymce-editor-help-image-{{ themeSuffix }}.png" /></li>
          <li>Then choose an optional 'Article Publish Date'.</li>
          <li class="list-item-hide-ordinal important">
            <div>
              <div>Summary</div>
              <div>
                New data can only be submitted from within the 'Choose Image' modal dialog panel. Edited data can either be submitted from within the 'Choose Image' modal dialog panel, from within the text editor dialog or by pressing the 'Submit' button at the bottom of this page. Image data can only be submitted from within the 'Choose Image' modal dialog panel. Article data can only be submitted from within the text editor dialog.
              </div>
            </div>
          </li>
          <li value="1">New submissions and updates are subject to moderation. Please be patient whilst our moderation team assess your submission. We endeavour to approve submissions within 24 hours.</li>
          <li>Immediately after submission, you will be able to see it in the '{{ catalogRouterAliasTitle }}' section. Other users will be unable to see your submission, during the approval phase. You can also edit your submission whilst approval is pending.</li>
          <li>After approval has been granted, you may prevent other users from seeing your submission, by using the 'Article Publish Date' feature. Other users will be unable to see your submission until the 'Article Publish Date' has passed.</li>
          <li>Please note that submissions, containing offensive language or imagery, will be rejected.</li>
        </ol>
      </div>
    </div>
  </div>
  <mat-icon class="dialog-article-help-notification-close" (click)="closeArticleHelpNotificationDialog()" ngbTooltip="Close" [disableTooltip]="disableArticleTooltip" [container]="'body'">close</mat-icon>
</ng-template>

<ng-template class="dialog-article" #dialogArticle *ngIf="fileImageId > 0">
  <div class="dialog-article-container">
    <app-tinymce [tinyMceArticleElementId]="tinyMceArticleElementId" [tinyMceArticleContent]="tinyMceArticleContent" [fileImageId]="fileImageId" [tinymceArticleImageCount]="tinymceArticleImageCount" [tinymceArticleImages]="tinymceArticleImages" [isMobile]="isMobile" [tinyMceArticleMaxWordCount]="tinyMceArticleMaxWordCount" (onEditorChange)="tinyMceArticleKeyupHandler($event)"></app-tinymce>
    <div class="button-actions" *ngIf="!isMobile">
      <button mat-raised-button data-role="submit" (click)="deferEditImage(editImageId)" *ngIf="mode == 'edit'" color="accent">Submit</button>
      <div class="dialog-article-footer-data" *ngIf="tinyMceArticleMaxWordCount > 0"><i class="fa fa-bolt"></i>Maximum word count: {{ tinyMceArticleMaxWordCount }}</div>
      <div class="dialog-article-footer-data">
        <i class="fa fa-bolt"></i>
        <span *ngIf="hasUnsavedChanges" class="dialog-article-footer-data-warn">Unsaved changes</span>
        <span *ngIf="!hasUnsavedChanges">Changes up-to-date</span>
      </div>
      <mat-icon class="article-close" (click)="closeArticleDialog()" ngbTooltip="Close" [disableTooltip]="disableArticleTooltip" [container]="'body'">close</mat-icon>
    </div>
    <div class="mobile-dialog-article-footer-data-container" *ngIf="isMobile">
      <div class="dialog-article-footer-data" *ngIf="tinyMceArticleMaxWordCount > 0"><i class="fa fa-bolt"></i>Maximum word count: {{ tinyMceArticleMaxWordCount }}</div>
      <div class="dialog-article-footer-data">
        <i class="fa fa-bolt"></i>
        <span *ngIf="hasUnsavedChanges" class="dialog-article-footer-data-warn">Unsaved changes</span>
        <span *ngIf="!hasUnsavedChanges">Changes up-to-date</span>
      </div>
    </div>
    <div class="button-actions" *ngIf="isMobile">
      <button mat-raised-button data-role="submit" (click)="deferEditImage(editImageId)" *ngIf="mode == 'edit'" color="accent">Submit</button>
      <mat-icon class="article-close" (click)="closeArticleDialog()" ngbTooltip="Close" [disableTooltip]="disableArticleTooltip" [container]="'body'">close</mat-icon>
    </div>
  </div>
</ng-template>

<form novalidate [formGroup]="treeForm" *ngIf="!forgottenPasswordForm && userid > 0">

  <div class="form-field-container">

    <div class="form-field-legend">Image details<div *ngIf="mode == 'edit'" (click)="previous()"><mat-icon>arrow_left</mat-icon></div><div *ngIf="mode == 'edit'" (click)="next()"><mat-icon>arrow_right</mat-icon></div><mat-icon *ngIf="mode != 'edit'" (click)="openArticleHelpNotificationDialog()">help</mat-icon></div>

    <div class="form-field-text">

      <mat-form-field class="example-full-width">
        <input matInput placeholder="Author" value="" formControlName="name" id="name" required>
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <input matInput placeholder="Image Title" value="" formControlName="title" id="title" required>
      </mat-form-field><br />
      <div [hidden]="title.valid || title.pristine" class="alert alert-danger">
        Image title is required and must be less than {{maxTitleLength}} characters
      </div><br />

      <mat-form-field class="example-full-width">
        <textarea matInput placeholder="Image Description" formControlName="description" id="description" [maxlength]="articledescriptionmaxcharcount" required></textarea>
      </mat-form-field>

      <div class="image-description-charcount-container">
        <div class="image-description-charcount-label">Character Count</div><div class="image-description-charcount-text" id="image-description-charcount-text">{{ articleDescriptionCharcount }}</div>
      </div>

      <tag-input formControlName="tags" [animationDuration]="{enter: '0ms', leave: '0ms'}" [maxItems]="5" [separatorKeyCodes]="[13,32]" [errorMessages]="errorMessages" [validators]="validators" (onRemove)="onTagRemoved($event)" (onTextChange)="onTagInputTextChange($event)" (onAdd)="onTagAdded($event)">
        <tag-input-dropdown [autocompleteObservable]="fetchAutocompleteItems" [appendToBody]="false" [dynamicUpdate]="false">
        </tag-input-dropdown>
      </tag-input><br />

      <div class="form-button-container" [ngStyle]="{'display': fileImageId > 0 ? 'block' : 'none'}">
        <button mat-raised-button (click)="openArticleDialog()">Write Article</button>
        <button mat-raised-button (click)="previewArticle()" [ngStyle]="{'display': formData['article'] !== '' ? 'block' : 'none'}">Preview Article</button>
        <div style="clear:both;"></div>
      </div>

      <p [ngStyle]="{'display': formData['article'] !== '' && fileImageId > 0 ? 'block' : 'none'}">
        <br />
        <mat-form-field>
          <input matInput [matDatepicker]="dp3" placeholder="Article Publish Date" readonly formControlName="publishArticleDate">
          <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
          <mat-datepicker #dp3 disabled="false"></mat-datepicker>
        </mat-form-field><br />
      </p>

    </div>

  </div>

  <div class="form-field-container">

    <div class="form-field-legend" *ngIf="!isMobile">Please choose a category for your image</div>
    <div class="form-field-legend" *ngIf="isMobile">Please choose a category</div>

    <div class="form-field-text">

      <div class="mat-tree-container">

        <div [hidden]="!hasError" class="alert alert-full-width alert-danger" [innerHtml]="safeHtml">
        </div>
        
        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
          <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
            <button [attr.id]="'button-' + node.id" mat-icon-button disabled></button>
            <!-- {{node.item}} -->
            <a (click)="addPath($event,node.item)">{{ node.item | nameFormat }}</a>
            <mat-icon class="mat-icon-rtl-mirror grade" [attr.id]="'icon-' + node.id" color="accent">
              {{iconSelected == node.id ? 'grade' : ''}}
            </mat-icon>
          </mat-tree-node>
          <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
            <button [attr.id]="'button-' + node.id" mat-icon-button
                    [attr.aria-label]="'toggle ' + node.filename" matTreeNodeToggle>
              <mat-icon class="mat-icon-rtl-mirror">
                {{ treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
              </mat-icon>
            </button>
            {{ node.item | nameFormat }}
            <mat-progress-bar *ngIf="node.isLoading"
                              mode="indeterminate"
                              class="tree-progress-bar"></mat-progress-bar>
          </mat-tree-node>
        </mat-tree>

        <mat-form-field class="example-full-width" id="imageAccreditationContainer">
          <input matInput placeholder="Image Accreditation" value="" formControlName="imageAccreditation" id="imageAccreditation">
        </mat-form-field><br />

        <div id="imageOrientationContainer" class="panel">
          <mat-select formControlName="imageOrientation" class="panel-legend" placeholder="Image Orientation" floatLabel="never">
            <mat-select-trigger>Image Orientation</mat-select-trigger>
            <mat-option value="auto">
              auto
            </mat-option>
            <mat-option value="landscape" selected="selected">
              landscape
            </mat-option>
          </mat-select>
        </div>

      </div>

      <div class="uploaded-image-container-outer">
        <div class="uploaded-image-container" id="uploaded-image-container" #uploadedImageContainer *ngIf="isEditImageValid" [innerHTML]="htmlStr"></div>
      </div>

      <div style="clear:both;"></div>

      <app-upload *ngIf="userid > 0 && mode == 'edit'"></app-upload>

      <div class="form-button-container">
        <ng-template [ngIf]="adminUserId > 0">
          <button class="approve" mat-raised-button (click)="approve(editImageId)" *ngIf="adminApprovedText == 'Unapprove'" color="warn">{{ adminApprovedText }}</button>
          <button class="approve" mat-raised-button (click)="approve(editImageId)" *ngIf="adminApprovedText == 'Approve'" style="background-color:#8bc34a;">{{ adminApprovedText }}</button>
        </ng-template>
        <button mat-raised-button data-role="submit" (click)="editImage(editImageId)" *ngIf="mode == 'edit'" color="accent">Submit</button>
        <button mat-raised-button (click)="back(editImageId)" *ngIf="mode == 'edit'" [ngStyle]="{'margin-top': mode == 'edit' ? '40px' : '0px'}">Back</button>
      </div>

      <app-upload *ngIf="userid > 0 && mode == 'add'"></app-upload>

    </div>

  </div>

</form>



<form novalidate [formGroup]="signUpForm" *ngIf="!forgottenPasswordForm && userid == 0 && signUpValidated == 0">

  <div class="form-field-container">

    <div class="form-field-legend">Sign up</div>

    <div class="form-field-text">

      <mat-form-field class="example-full-width">
        <input matInput placeholder="First Name" value="" formControlName="forename" id="forename" required>
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <input matInput placeholder="Last Name" value="" formControlName="surname" id="surname" required>
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <input matInput placeholder="Display Name" value="" formControlName="displayName" id="displayName">
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <input matInput placeholder="E-mail" value="" formControlName="email" type="email" id="email" required autocomplete="off">
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <div class="app-password-container">
          <mat-icon id="app-password">visibility</mat-icon>
          <input matInput placeholder="Password" value="" formControlName="password" type="password" id="password" required appPassword autocomplete="off">
        </div>
      </mat-form-field><br />

      <div *ngIf="recaptchaType==='google'">
        <div id="google-recaptcha-{{ googleRecaptchaId1 }}" appGoogleRecaptcha key="{{ googleRecaptchaSiteKey }}" appGoogleRecaptchaId="google-recaptcha-{{ googleRecaptchaId1 }}" formControlName="captcha" (captchaResponse)="captchaResponse($event)" (captchaExpired)="captchaExpired($event)"></div>
      </div>

      <button mat-raised-button data-role="submit" [disabled]="signUpForm.invalid" (click)="signUpFormSubmit()" style="margin-left:0px;" color="accent" *ngIf="recaptchaType==='google'">Submit</button>

      <div class="app-custom-recaptcha" appCustomRecaptcha appCustomRecaptchaRotationMax="{{ customRecaptchaRotationMax }}" appCustomRecaptchaStrLength="{{ customRecaptchaStrLength }}" *ngIf="recaptchaType==='custom'">
        <mat-form-field class="example-full-width">
          <input matInput placeholder="Copy characters & numbers below" value="" formControlName="captcha" type="text" id="captcha" required>
        </mat-form-field><br />
        <i class="fa fa-refresh" (click)="resetCustomCaptcha($event)" ngbTooltip="Refresh Captcha" [disableTooltip]="disableCustomCaptchaGeneralTooltip" [container]="'body'"></i>
      </div>

      <button mat-raised-button data-role="submit" [disabled]="signUpFormDisabled" (click)="signUpFormSubmit()" style="margin-left:0px;" color="accent" *ngIf="recaptchaType==='custom'">Submit</button>

      <div *ngIf="recaptchaType===''">
        <button mat-raised-button data-role="submit" [disabled]="signUpFormDisabled" (click)="signUpFormSubmit()" style="margin-left:0px;" color="accent">Submit</button>
      </div>

    </div>

  </div>

</form>



<form novalidate [formGroup]="loginForm" *ngIf="!forgottenPasswordForm && userid == 0 && signUpValidated == 1">

  <div class="form-field-container">

    <div class="form-field-legend">Login</div>

    <div class="form-field-text">

      <mat-form-field class="example-full-width">
        <input matInput placeholder="E-mail" value="" formControlName="email" type="email" id="email" required>
      </mat-form-field><br />

      <mat-form-field class="example-full-width">
        <div class="app-password-container">
          <mat-icon id="app-password">visibility</mat-icon>
          <input matInput placeholder="Password" value="" formControlName="password" type="password" id="password" required appPassword autocomplete="off">
        </div>
      </mat-form-field><br />

      <mat-checkbox formControlName="keeploggedin">Keep me logged in</mat-checkbox><br />

      <div *ngIf="recaptchaType==='google'">
        <div class="google-recaptcha-loading" id="google-recaptcha-{{ googleRecaptchaId2 }}" appGoogleRecaptcha key="{{ googleRecaptchaSiteKey }}" appGoogleRecaptchaId="google-recaptcha-{{ googleRecaptchaId2 }}" formControlName="captcha" (captchaResponse)="captchaResponse($event)" (captchaExpired)="captchaExpired($event)"></div>
      </div>

      <button mat-raised-button data-role="submit" [disabled]="loginFormDisabled" (click)="loginFormSubmit()" style="margin-left:0px;" color="accent" *ngIf="recaptchaType==='google'">Submit</button>
      <button mat-raised-button (click)="forgottenPassword()" style="margin-left:20px;" *ngIf="recaptchaType==='google'">Forgotten Password</button>

      <div class="app-custom-recaptcha" appCustomRecaptcha appCustomRecaptchaRotationMax="{{ customRecaptchaRotationMax }}" appCustomRecaptchaStrLength="{{ customRecaptchaStrLength }}" *ngIf="recaptchaType==='custom'">
        <mat-form-field class="example-full-width">
          <input matInput placeholder="Copy characters & numbers below" value="" formControlName="captcha" type="text" id="captcha" required>
        </mat-form-field><br />
        <i class="fa fa-refresh" (click)="resetCustomCaptcha($event)" ngbTooltip="Refresh Captcha" [disableTooltip]="disableCustomCaptchaGeneralTooltip" [container]="'body'"></i>
      </div>

      <button mat-raised-button data-role="submit" [disabled]="loginFormDisabled" (click)="loginFormSubmit()" style="margin-left:0px;" color="accent" *ngIf="recaptchaType==='custom'">Submit</button>
      <button mat-raised-button (click)="forgottenPassword()" style="margin-left:20px;" *ngIf="recaptchaType==='custom'">Forgotten Password</button>

      <div *ngIf="recaptchaType===''">
        <button mat-raised-button data-role="submit" [disabled]="loginFormDisabled" (click)="loginFormSubmit()" style="margin-left:0px;" color="accent">Submit</button>
        <button mat-raised-button (click)="forgottenPassword()" style="margin-left:20px;">Forgotten Password</button>
      </div>

    </div>

  </div>

</form>


<form novalidate [formGroup]="forgottenPasswordForm" *ngIf="isForgottenPasswordForm">

  <div class="form-field-container">

    <div class="form-field-legend">Forgotten Password</div>

    <div class="form-field-text">

      <mat-form-field class="example-full-width">
        <input matInput placeholder="E-mail" value="" formControlName="email" type="email" id="email" required>
      </mat-form-field><br />

      <div *ngIf="recaptchaType==='google'">
        <div class="google-recaptcha-loading" id="google-recaptcha-{{ googleRecaptchaId2 }}" appGoogleRecaptcha key="{{ googleRecaptchaSiteKey }}" appGoogleRecaptchaId="google-recaptcha-{{ googleRecaptchaId2 }}" formControlName="captcha" (captchaResponse)="captchaResponse($event)" (captchaExpired)="captchaExpired($event)"></div>
      </div>

      
      <div class="app-custom-recaptcha" appCustomRecaptcha appCustomRecaptchaRotationMax="{{ customRecaptchaRotationMax }}" appCustomRecaptchaStrLength="{{ customRecaptchaStrLength }}" *ngIf="recaptchaType==='custom'">
        <mat-form-field class="example-full-width">
          <input matInput placeholder="Copy characters & numbers below" value="" formControlName="captcha" type="text" id="captcha" required>
        </mat-form-field><br />
        <i class="fa fa-refresh" (click)="resetCustomCaptcha($event)" ngbTooltip="Refresh Captcha" [disableTooltip]="disableCustomCaptchaGeneralTooltip" [container]="'body'"></i>
      </div>

      
      <button mat-raised-button data-role="submit" [disabled]="forgottenPasswordFormDisabled" (click)="forgottenPasswordFormSubmit()" style="margin-left:0px;" color="accent">Submit</button>

    </div>

  </div>

</form>



